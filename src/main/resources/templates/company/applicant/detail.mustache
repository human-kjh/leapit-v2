{{> layout/company-header}}
<input name="isViewed" value="true" type="hidden">

            <!-- 본문 -->
            <div class="bg-light">
                <div class="main container">
                    <div class="d-flex bg-light">
                        <!-- 왼쪽 -->
                        <div class="left-panel bg-white p-3 mt-4 ms-4 mb-4">
                            <div class="text-secondary fs-5 mt-1 mb-4 ms-1">지원번호 : {{model.id}}</div>
                            <div class="d-flex align-items-center gap-2 mt-4 mb-4">

                                <h1 class="fw-bold">{{model.detailDTO.name}}</h1>
                            </div>

                            <!-- 버튼 그룹 영역 -->
                            <div class="mt-auto">
                                <div id="passStatusText" class="fw-bold mb-3">
                                    <!-- 여기에 합격/불합격 상태 텍스트가 들어갈 예정 -->
                                </div>
                                <div class="mb-3 w-100">
                                    <button id="scrapButton" onclick="scrapApplication()"
                                        class="btn btn-primary w-100 fs-5 d-flex align-items-center justify-content-center gap-2">
                                        <i class="fa fa-bookmark-o me-2"></i>
                                        스크랩하기
                                    </button>
                                </div>
                                <div class="mb-3 w-100">
                                    <button id="passButton" onclick="passButtonClick()"
                                        class="btn btn-outline-primary w-100 fs-5 d-flex align-items-center justify-content-center gap-2">
                                        <i class="fa fa-thumbs-up"></i>
                                        합격
                                    </button>
                                </div>
                                <div class="w-100">
                                    <button id="failButton" onclick="failButtonClick()"
                                        class="btn btn-outline-danger w-100 fs-5 d-flex align-items-center justify-content-center gap-2">
                                        <i class="fa fa-thumbs-down"></i>
                                        불합격
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 오른쪽 -->
                        <div class="right-panel d-flex flex-column mt-4 me-4 ms-3">
                            <div class="bg-white p-3 mb-4">
                                <div class="bg-white rounded-3 px-4 py-3 d-flex justify-content-between align-items-center mt-1 mb-4 shadow-sm">
                                    <h4 class="fw-semibold">{{model.jobPositionTitle}}</h4>
                                </div>
                                <!-- 이력서 상세 페이지 가져오기 -->
                                <div class="resume-container">
                                    <!-- 이력서 제목 -->
                                    <div
                                            class="bg-white rounded-3 px-4 py-3 d-flex justify-content-between align-items-center mb-4 shadow-sm">
                                        <h5 class="mb-0 fw-semibold">{{model.detailDTO.title}}</h5>
                                    </div>

                                    <!-- 기본정보 (수정된 구조) -->
                                    <div class="row g-4 align-items-stretch mb-4">
                                        {{#model.detailDTO.photoUrl}}
                                            <!-- 사진 영역 -->
                                            <div class="col-md-3">
                                                <div class="h-100 d-flex flex-column justify-content-center align-items-center bg-light rounded-3 shadow-sm"
                                                     style="width: 100%; aspect-ratio: 1 / 1; min-height: 100%;">
                                                    <img src="{{model.detailDTO.photoUrl}}" alt="프로필 사진" class="img-fluid rounded-3" style="object-fit: cover; width: 100%; height: 100%;">
                                                </div>
                                            </div>
                                            <!-- 기본정보 영역 -->
                                            <div class="col-md-9">
                                                <div class="bg-white rounded-3 p-4 shadow-sm h-100">
                                                    <div class="mb-2 d-flex flex-wrap align-items-center gap-3">
                                                        <div class="d-flex align-items-center">
                                                            <i class="bi bi-calendar3 me-2"></i>{{model.detailDTO.birthDate}}년생
                                                        </div>
                                                    </div>
                                                    <div class="mb-2 d-flex flex-wrap align-items-center gap-3">
                                                        <div class="d-flex align-items-center">
                                                            <i class="bi bi-envelope me-2"></i>{{model.detailDTO.email}}
                                                        </div>
                                                    </div>
                                                    <div class="mb-2 d-flex flex-wrap align-items-center gap-3">
                                                        <div class="d-flex align-items-center">
                                                            <i class="bi bi-telephone me-2"></i>{{model.detailDTO.contactNumber}}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {{/model.detailDTO.photoUrl}}
                                        {{^model.detailDTO.photoUrl}}
                                            <!-- 기본정보 영역 -->
                                            <div class="col-md-12">
                                                <div class="bg-white rounded-3 p-4 shadow-sm h-100">
                                                    <div class="d-flex justify-content-between align-items-start mb-5">
                                                        <h5 class="fw-bold mb-0">{{model.detailDTO.name}}</h5>
                                                        <a href="/personal/user/update-form" class="btn btn-outline-secondary btn-sm">계정 정보 설정</a>
                                                    </div>

                                                    <div class="mb-2 d-flex flex-wrap align-items-center gap-3">
                                                        <div class="d-flex align-items-center">
                                                            <i class="bi bi-calendar3 me-2"></i>{{model.detailDTO.birthDate}}년생
                                                        </div>
                                                    </div>
                                                    <div class="mb-2 d-flex flex-wrap align-items-center gap-3">
                                                        <div class="d-flex align-items-center">
                                                            <i class="bi bi-envelope me-2"></i>{{model.detailDTO.email}}
                                                        </div>
                                                    </div>
                                                    <div class="mb-2 d-flex flex-wrap align-items-center gap-3">
                                                        <div class="d-flex align-items-center">
                                                            <i class="bi bi-telephone me-2"></i>{{model.detailDTO.contactNumber}}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {{/model.detailDTO.photoUrl}}
                                    </div>

                                    <!-- 간단소개 (선택항목) -->
                                    {{#model.detailDTO.summary}}
                                        <div class="bg-white rounded-3 p-4 mb-4 shadow-sm">
                                            <label class="form-label fw-bold">간단소개</label>
                                            <hr class="mt-1 mb-3" />
                                            <div class="bg-light rounded-2 px-3 py-2">
                                                {{model.detailDTO.summary}}
                                            </div>
                                        </div>
                                    {{/model.detailDTO.summary}}

                                    <!-- 개발 직무 -->
                                    <div class="bg-white rounded-3 p-4 mb-4 shadow-sm">
                                        <label class="form-label fw-bold"><span class="text-danger">*</span> 개발 직무</label>
                                        <hr class="mt-1 mb-3" />
                                        <div class="bg-light rounded-2 px-3 py-2 d-flex align-items-center">
                                            <div>{{model.detailDTO.positionType}}</div>
                                        </div>
                                    </div>

                                    <!-- 기술스택 -->
                                    <div class="bg-white rounded-3 p-4 mb-4 shadow-sm">
                                        <label class="form-label fw-bold"><span class="text-danger">*</span> 기술스택(업무
                                            툴/스킬)</label>
                                        <hr class="mt-1 mb-3" />
                                        <div class="mb-2 d-flex flex-wrap gap-2 fs-5">
                                            {{#model.detailDTO.techStackList}}
                                                <span class="badge bg-secondary">{{techStack}}</span>
                                            {{/model.detailDTO.techStackList}}
                                        </div>
                                    </div>

                                    <!-- 링크 (선택항목) -->
                                    {{#model.detailDTO.links.0}}
                                        <div class="bg-white rounded-3 p-4 mb-4 shadow-sm">
                                            <label class="form-label fw-bold">링크</label>
                                            <hr class="mt-1 mb-3" />
                                            <div>
                                                {{#model.detailDTO.links}}
                                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                                        <div class="d-flex align-items-start gap-2">
                                                            <div>
                                                                <strong>{{title}}</strong><br /><a href="{{url}}" target="_blank"
                                                                                                   class="text-decoration-none text-muted">{{url}} <i class="bi bi-box-arrow-up-right"></i></a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                {{/model.detailDTO.links}}
                                            </div>
                                        </div>
                                    {{/model.detailDTO.links.0}}

                                    <!-- 학력 -->
                                    <div class="bg-white rounded-3 p-4 mb-4 shadow-sm">
                                        <label class="form-label fw-bold">
                                            <span class="text-danger">*</span> 학력
                                        </label>
                                        <hr class="mt-1 mb-3" />

                                        {{#model.detailDTO.educations}}
                                            <div class="d-flex flex-wrap education-wrapper gap-3 mb-3">
                                                <!-- 왼쪽: 졸업예정/중퇴 -->
                                                <div class="left-edu-box" style="min-width: 180px;">
                                                    <label for="graduateMonth" class="form-label fw-bold"><span class="text-danger">*</span> 졸업(예정)</label>
                                                    <div class="mb-2">{{graduationDate}}</div>
                                                    {{#isDropOut}}
                                                        <div class="form-check mt-1 ps-0">
                                                            <span class="badge bg-primary mb-2">중퇴</span>
                                                        </div>
                                                    {{/isDropOut}}
                                                </div>

                                                <!-- 오른쪽: 학력구분 ~ 학점 -->
                                                <div class="right-edu-box flex-grow-1">
                                                    <div class="row gx-2 mb-2">
                                                        <div class="col-4">
                                                            <div><span class="text-danger">*</span><span class="fw-semibold me-2"> 학력 구분 : </span><span>{{educationLevel}}</span></div>
                                                        </div>
                                                        <div class="col-8">
                                                            <span class="fw-semibold me-2"><span class="text-danger">*</span> 대학명 : </span><span>{{schoolName}}</span>
                                                        </div>
                                                    </div>
                                                    {{#major}}
                                                        <div class="mb-2">
                                                            <span class="fw-semibold me-2">학과명 : </span><span>{{major}}</span>
                                                        </div>
                                                    {{/major}}
                                                    {{#gpa}}
                                                        <div class="d-flex align-items-center gap-2">
                                                            <span class="fw-semibold me-2">학점 : </span><span>{{gpa}} / {{gpaScale}}</span>
                                                        </div>
                                                    {{/gpa}}
                                                </div>
                                            </div>
                                        {{/model.detailDTO.educations}}
                                    </div>

                                    <!-- 경력(업무경험) 입력 폼 (선택항목) -->
                                    {{#model.detailDTO.experiences.0}}
                                        <div class="bg-white rounded-3 p-4 mb-4 shadow-sm">
                                            <label class="form-label fw-bold mb-2 fw-bold">경력(업무경험)</label>
                                            <hr class="mt-1 mb-3" />
                                            {{#model.detailDTO.experiences}}
                                                <div class="row mb-3">
                                                    <!-- 좌측: 근무기간 -->
                                                    <div class="col-md-4 mb-2">
                                                        <div class="fw-semibold mb-1"><span class="text-danger">*</span> 근무기간</div>
                                                        {{#isEmployed}}
                                                            <div>{{startDate}} ~ </div>
                                                            <span class="badge bg-primary mt-1">재직중</span>
                                                        {{/isEmployed}}
                                                        {{^isEmployed}}
                                                            <div>{{startDate}} ~ {{endDate}}</div>
                                                        {{/isEmployed}}
                                                    </div>

                                                    <!-- 우측: 상세내용 -->
                                                    <div class="col-md-8">
                                                        <div><strong><span class="text-danger">*</span> 회사명 : </strong>{{companyName}}</div>
                                                        {{#summary}}
                                                            <div><strong>회사 소개 : </strong>{{summary}}</div>
                                                        {{/summary}}
                                                        {{#position}}
                                                            <div><strong>부서명/직책 : </strong> {{position}}</div>
                                                        {{/position}}
                                                        <div class="mt-2">
                                                            {{#techStackList}}
                                                                <span class="badge bg-secondary me-1">{{techStack}}</span>
                                                            {{/techStackList}}
                                                        </div>
                                                        <div class="bg-light rounded mt-2 p-2"><span class="text-danger">*</span>
                                                            {{responsibility}}
                                                        </div>
                                                    </div>
                                                </div>
                                            {{/model.detailDTO.experiences}}
                                        </div>
                                    {{/model.detailDTO.experiences.0}}

                                    <!--프로젝트 부분-->
                                    <div class="bg-white rounded-3 p-4 mb-4 shadow-sm">
                                        <label class="form-label fw-bold"><span class="text-danger">*</span> 프로젝트</label>
                                        <hr class="mt-1 mb-3" />
                                        {{#model.detailDTO.projects}}
                                            <div class="d-flex flex-wrap gap-3 mb-3">
                                                <!-- 좌측: 프로젝트 기간 -->
                                                <div style="min-width: 180px;">
                                                    <div class="fw-semibold mb-1"><span class="text-danger">*</span> 프로젝트 기간</div>
                                                    {{#isOngoing}}
                                                        <div>{{startDate}} ~ </div>
                                                        <span class="badge bg-primary mt-1">진행중</span>
                                                    {{/isOngoing}}
                                                    {{^isOngoing}}
                                                        <div>{{startDate}} ~ {{endDate}}</div>
                                                    {{/isOngoing}}
                                                </div>

                                                <!-- 우측: 프로젝트 상세 -->
                                                <div class="flex-grow-1">
                                                    <div><span class="text-danger">*</span><strong> 프로젝트명 :</strong> {{title}}</div>
                                                    {{#summary}}
                                                        <div><strong>프로젝트 소개 :</strong> {{summary}}</div>
                                                    {{/summary}}
                                                    <div class="mt-2">
                                                        {{#techStackList}}
                                                            <span class="badge bg-secondary me-1">{{techStack}}</span>
                                                        {{/techStackList}}
                                                    </div>
                                                    <div class="bg-light rounded mt-2 p-2">
                                                        <span class="text-danger">*</span> {{description}}
                                                    </div>
                                                    {{#repositoryUrl}}
                                                        <div class="mt-2">
                                                            <div><strong>저장소 링크</strong></div>
                                                            <div class="bg-light p-2 rounded text-muted">{{repositoryUrl}}</div>
                                                        </div>
                                                    {{/repositoryUrl}}
                                                </div>
                                            </div>
                                        {{/model.detailDTO.projects}}
                                    </div>

                                    <!--교육이력 부분 (선택항목)-->
                                    {{#model.detailDTO.trainings.0}}
                                        <div class="bg-white rounded-3 p-4 mb-4 shadow-sm">
                                            <label class="form-label fw-bold mb-2">
                                                교육이력
                                            </label>
                                            <hr class="mt-1 mb-3" />

                                            <!-- 전체 wrapper -->
                                            {{#model.detailDTO.trainings}}
                                                <div class="d-flex flex-wrap gap-3 mb-3">
                                                    <!-- 날짜 및 진행 중 -->
                                                    <div class="d-flex flex-column" style="min-width: 200px">
                                                        {{#isOngoing}}
                                                            <div class="mb-2">
                                                                <label class="form-label fw-bold"><span class="text-danger">*</span> 교육 기간</label>
                                                                <div class="d-flex align-items-center gap-2">
                                                                    <!-- 시작일 -->
                                                                    <div>{{startDate}}</div>
                                                                    ~
                                                                </div>
                                                            </div>
                                                            <div class="form-check ps-0">
                                                                <span class="badge bg-primary mb-2">진행중</span>
                                                            </div>
                                                        {{/isOngoing}}
                                                        {{^isOngoing}}
                                                            <div class="mb-2">
                                                                <label class="form-label fw-bold"><span class="text-danger">*</span> 교육 기간</label>
                                                                <div class="d-flex align-items-center gap-2">
                                                                    <!-- 시작일 -->
                                                                    <div>{{startDate}}</div>
                                                                    ~
                                                                    <!-- 종료일 -->
                                                                    <div>{{endDate}}</div>
                                                                </div>
                                                            </div>
                                                        {{/isOngoing}}
                                                    </div>
                                                    <!-- 교육이력 정보 영역 -->
                                                    <div class="flex-grow-1">
                                                        <div class="mb-2">
                                                            <span class="fw-semibold me-2"><span class="text-danger">*</span> 교육명 : </span><span>{{courseName}}</span>
                                                        </div>

                                                        <div class="row gx-2 mb-2">
                                                            <div>
                                                                <span class="fw-semibold me-2"><span class="text-danger">*</span> 교육기관 : </span><span>{{institutionName}}</span>
                                                            </div>
                                                        </div>
                                                        <div class="mb-2 d-flex flex-wrap gap-2">
                                                            {{#techStackList}}
                                                                <span class="badge bg-secondary me-1">{{techStack}}</span>
                                                            {{/techStackList}}
                                                        </div>
                                                        <div class="mb-2 bg-light p-2">
                                                            <span><span class="text-danger">*</span> {{description}}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            {{/model.detailDTO.trainings}}
                                        </div>
                                    {{/model.detailDTO.trainings.0}}

                                    <!--기타 사항 부분 (선택항목)-->
                                    {{#model.detailDTO.etcs.0}}
                                        <div class="bg-white rounded-3 p-4 mb-4 shadow-sm">
                                            <label class="form-label fw-bold mb-2">
                                                기타사항
                                            </label>
                                            <hr class="mt-1 mb-3" />
                                            <!-- 전체 wrapper -->
                                            {{#model.detailDTO.etcs}}
                                                <div class="d-flex flex-wrap gap-3 mb-3">
                                                    <!-- 교육기간 및 종료일 유무 -->
                                                    <div class="d-flex flex-column" style="min-width: 200px">
                                                        <div class="mb-2">
                                                            <label class="form-label fw-bold"><span class="text-danger">*</span> 교육 기간</label>
                                                            {{#hasEndDate}}
                                                                <div class="d-flex align-items-center gap-2">
                                                                    <!-- 시작일 -->
                                                                    <div>{{startDate}}</div>
                                                                    ~
                                                                    <!-- 종료일 -->
                                                                    <div>{{endDate}}</div>
                                                                </div>
                                                            {{/hasEndDate}}
                                                            {{^hasEndDate}}
                                                                <div class="d-flex align-items-center gap-2">
                                                                    <!-- 시작일 -->
                                                                    <div>{{startDate}}</div>
                                                                </div>
                                                                <div class="form-check ps-0">
                                                                    <span class="badge bg-primary mb-2">종료일 없음</span>
                                                                </div>
                                                            {{/hasEndDate}}
                                                        </div>
                                                    </div>

                                                    <div class="flex-grow-1">
                                                        <div class="mb-2">
                                                            <span class="fw-semibold me-2"><span class="text-danger">*</span> 활동명/이력제목 : </span><span>{{title}}</span>
                                                        </div>

                                                        <div class="row gx-2 mb-2">
                                                            <div class="col-md-4">
                                                                <span class="text-danger">*</span> {{etcType}}
                                                            </div>
                                                            <div class="col-md-8">
                                                                <div>
                                                                    <span class="fw-semibold me-2"><span class="text-danger">*</span> 교육기관 : </span><span>{{institutionName}}</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="mb-2">
                                                            <div class="mb-2 bg-light p-2">
                                                                <span><span class="text-danger">*</span> {{description}}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            {{/model.detailDTO.etcs}}
                                        </div>
                                    {{/model.detailDTO.etcs.0}}

                                    <!-- 자기소개서 (선택항목) -->
                                    {{#model.detailDTO.selfIntroduction}}
                                        <div class="form-section bg-white rounded-3 p-4 mb-4 shadow-sm">
                                            <label class="form-label fw-bold mb-1 text-dark">
                                                <span class="text-danger">*</span> 자기소개서
                                            </label>
                                            <hr class="my-2" />
                                            <div>
                                                <div class="mb-2 bg-light p-2">
                                                    <div>{{model.detailDTO.selfIntroduction}}</div>
                                                </div>
                                            </div>
                                        </div>
                                    {{/model.detailDTO.selfIntroduction}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 본문 끝 -->
            <script>
                let isBookmarked = {{#model.isBookmarked}}true{{/model.isBookmarked}}{{^model.isBookmarked}}false{{/model.isBookmarked}};

                let scrapButton = document.querySelector('#scrapButton');
                if (isBookmarked) {
                    scrapButton.innerHTML = `<i class="fa fa-bookmark-o me-2"></i> 스크랩 취소`;
                } else {
                    scrapButton.innerHTML = `<i class="fa fa-bookmark-o me-2"></i> 스크랩하기`;
                }

                async function scrapApplication() {
                    let requestBody = {
                        applicationId: {{model.id}}
                    };

                    try {
                        if (!isBookmarked) {
                            let response = await fetch("/s/api/company/bookmark", {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json"
                                },
                                body: JSON.stringify(requestBody)
                            });

                            let responseBody = await response.json();

                            if (responseBody.status === 200) {
                                alert("스크랩되었습니다");
                                isBookmarked = true;
                                scrapButton.innerHTML = `<i class="fa fa-bookmark-o me-2"></i> 스크랩 취소`;
                            } else {
                                alert(responseBody.msg || "스크랩 실패");
                            }

                        } else {
                            let response = await fetch(`/s/api/company/bookmark/{{model.id}}`, {
                                method: "DELETE"
                            });

                            let responseBody = await response.json();

                            if (responseBody.status === 200) {
                                alert("스크랩이 취소되었습니다");
                                isBookmarked = false;
                                scrapButton.innerHTML = `<i class="fa fa-bookmark-o me-2"></i> 스크랩하기`;
                            } else {
                                alert(responseBody.msg || "스크랩 취소 실패");
                            }
                        }

                    } catch (error) {
                        console.error("스크랩 처리 중 오류:", error);
                        alert(error.message || "스크랩 요청 중 오류가 발생했습니다.");
                    }
                }

                let isPassed = null;
                let isPassedRaw = "{{model.isPassedString}}";
                if (isPassedRaw === "true") isPassed = true;
                else if (isPassedRaw === "false") isPassed = false;

                let passButton, failButton, passStatusText;

                document.addEventListener("DOMContentLoaded", function () {
                    passButton = document.querySelector('#passButton');
                    failButton = document.querySelector('#failButton');
                    passStatusText = document.querySelector('#passStatusText');
                    updateButtons();
                });

                function passButtonClick() {
                    if (isPassed === true) {
                        updateApplicationPassStatus(null); // 합격 취소
                    } else {
                        updateApplicationPassStatus(true); // 합격 처리
                    }
                }

                function failButtonClick() {
                    if (isPassed === false) {
                        updateApplicationPassStatus(null); // 불합격 취소
                    } else {
                        updateApplicationPassStatus(false); // 불합격 처리
                    }
                }

                async function updateApplicationPassStatus(newStatus) {
                    try {
                        let requestBody = {
                            isPassed: newStatus
                        };

                        let response = await fetch(`/s/api/company/applicant/{{model.id}}/pass`, {
                            method: "PUT",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify(requestBody)
                        });

                        let responseBody = await response.json();
                        console.log("응답 결과:", responseBody);

                        if (responseBody.status === 200) {
                            isPassed = newStatus;
                            updateButtons();
                        } else {
                            alert(responseBody.message || "상태 변경 실패");
                        }

                    } catch (error) {
                        console.error("합격/불합격 상태 변경 중 오류:", error);
                        alert(error.message || "요청 중 오류가 발생했습니다.");
                    }
                }

                function updateButtons() {
                    if (isPassed === true) {
                        passButton.innerHTML = `<i class="fa fa-thumbs-up"></i> 합격 취소`;
                        failButton.innerHTML = `<i class="fa fa-thumbs-down"></i> 불합격`;
                        passStatusText.innerHTML = `<span class="text-primary">[상태] : 합격</span>`;
                    } else if (isPassed === false) {
                        passButton.innerHTML = `<i class="fa fa-thumbs-up"></i> 합격`;
                        failButton.innerHTML = `<i class="fa fa-thumbs-down"></i> 불합격 취소`;
                        passStatusText.innerHTML = `<span class="text-danger">[상태] : 불합격</span>`;
                    } else {
                        passButton.innerHTML = `<i class="fa fa-thumbs-up"></i> 합격`;
                        failButton.innerHTML = `<i class="fa fa-thumbs-down"></i> 불합격`;
                        passStatusText.innerHTML = `[상태] : 대기`;
                    }
                }
            </script>


{{> layout/footer}}